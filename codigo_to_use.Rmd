---
title: "Projeto"
author: "Christian Neitzel, Diana Silva, Tiago Miranda"
date: "r format(Sys.time(), '%Y-%m-%d')"
output:
  html_document: default
  word_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

Objetivo do trabalho:

Este trabalho cont√©m uma an√°lise demonstrativa de express√£o gen√©tica diferencial, utilizando amostras de sequenciamento direcionado de 526 tumores de bexiga e seus normais correspondentes atrav√©s do MSK-IMPACT. O conjunto de dados selecionado inclui 526 amostras de mais de 400 pacientes, nas quais a express√£o gen√©tica foi quantificada.

Conjunto de Dados selecionados:
https://portal.gdc.cancer.gov/projects/TCGA-ACC 
https://www.ncbi.nlm.nih.gov/projects/gap/cgi-bin/study.cgi?study_id=phs000178.v11.p8&phv=354519&phd=&pha=&pht=7516&phvf=&phdf=&phaf=&phtf=&dssp=1&consent=&temp=1

Em primeiro lugar, procedemos √† instala√ß√£o dos packages necess√°rios para realizar a an√°lise da express√£o diferencial.


```{r}
# Instala√ß√£o e carregamento dos pacotes necess√°rios
# Verifica se o BiocManager est√° instalado e instala se necess√°rio
if (!requireNamespace("BiocManager", quietly = TRUE))
  install.packages("BiocManager")

# Verifica se o pacote cBioPortalData est√° instalado e instala se necess√°rio
if (!requireNamespace("cBioPortalData", quietly = TRUE))
  BiocManager::install("cBioPortalData")

BiocManager::install(c("edgeR", "limma", "Glimma", "gplots", "org.Mm.eg.db", "RColorBrewer", "TCGAbiolinks", "DESeq2"))

# Instala√ß√£o dos pacotes "GGally" e "tibble"
install.packages("GGally", dependencies = TRUE, repos = "https://CRAN.R-project.org/")
#install.packages("tibble")

# Carrega os pacotes instalados
library(edgeR)
library(limma)
library(Glimma)
library(gplots)
library(tidyverse)
library(ggplot2)
library(GGally)
library(tibble)
library(dplyr)
library(org.Mm.eg.db)
library(RColorBrewer)
library(TCGAbiolinks)
library(DESeq2)

# Carregamento do pacote cBioPortalData
library(cBioPortalData)

# Inicializa√ß√£o da API do cBioPortal
cbio <- cBioPortal()
```

## Including Plots

Nesta fase √© realizado o carregamento dos dados clinicos do estudo,  explorados os ensaios do estudo disponiveis e organizados em dataframes:

```{r pressure, echo=FALSE}
# Obter dados cl√≠nicos
bladder_clin <- clinicalData(api = cbio, studyId = "bladder_msk_2023")
bladder_clin
dim(bladder_clin)  # Deve retornar 526 linhas e 29 colunas

# Carrega os dados do cBioPortal
bladder = cBioDataPack("bladder_msk_2023", ask = FALSE)
bladder

# Lista os nomes dos ensaios dispon√≠veis no pacote dos dados do CBioPortal
names(assays(bladder))
# names(rowData(bladder)) # tipos de metadados associados a cada gene
# names(colData(bladder)) # tipos de metadados associados a cada amostra

# Summary dos dados
summary(bladder)

# Acessando os dados de cna e convertendo para um dataframe
dados_cna = assays(bladder)$cna
dados_cna_df = as.data.frame(dados_cna)

# Acessando os dados de cna_hg19 e convertendo para um dataframe
dados_cna_hg19 = assays(bladder)$cna_hg19.seg
dados_cna_hg19_df = as.data.frame(dados_cna_hg19)

# Acessando os dados de muta√ß√£o e convertendo para um dataframe
dados_mutacao = assays(bladder)$mutations
dados_mutacao_df = as.data.frame(dados_mutacao)

```
```{r}
# Extra√ß√£o dos Metadados
# Aceder aos ficheiros dos metadados (formato .txt) presentes dentro da pasta "bladder_msk_2023"
setwd("bladder_msk_2023")
meta_cna_hg19_seg <- read.delim("meta_cna_hg19_seg.txt", sep = ":", 
                                header = FALSE, 
                                row.names = 1, 
                                col.names = c("", "data")
                                )
meta_cna_hg19_seg

meta_cna <- read.delim("meta_cna.txt", sep = ":", 
                       header = FALSE, 
                       row.names = 1, 
                       col.names = c("", "data")
)
meta_cna

# Metadados do estudo
meta_study <- read.delim("meta_study.txt", sep = ":", 
                         header = FALSE, 
                         row.names = 1, 
                         col.names = c("", "data")
                         )
meta_study["citation", "data"] # Cita√ß√£o
meta_study["pmid", "data"]     # pmid (PubMed ID), permite encontrar o artigo da qual originaram os dados


```
```{r}
# Verificar colunas com valores NA
colSums(is.na(bladder_clin)) # Verifica quandos valores NA cada coluna tem
print(colSums(is.na(bladder_clin))[colSums(is.na(bladder_clin)) > 0]) # Mostra quais as colunas t√™m valores NA

# Get the column names of bladder_clin
column_names <- names(bladder_clin)

# Initialize an empty list to store numeric columns
numeric_columns <- c()

# Loop through each column and check if it contains numeric values
for (col in column_names) {
  if (is.numeric(bladder_clin[[col]])) {
    numeric_columns <- c(numeric_columns, col)
  }
}

# Print the list of numeric columns
print(numeric_columns)

```

Determinar as vari√°veis para a An√°lise Estat√≠stica

```{r}
str(bladder_clin) # as colunas s√£o todas do tipo chr (character)

library(dplyr)

# Convert specific columns to numeric
bladder_clin <- bladder_clin %>%
  mutate(
    SEQUENCING_OS_MONTHS = as.numeric(SEQUENCING_OS_MONTHS),
    AGE_AT_SEQ_REPORTED_YEARS = as.numeric(AGE_AT_SEQ_REPORTED_YEARS),
    FRACTION_GENOME_ALTERED = as.numeric(FRACTION_GENOME_ALTERED),
    MSI_SCORE = as.numeric(MSI_SCORE),
    MUTATION_COUNT = as.numeric(MUTATION_COUNT),
    SAMPLE_COVERAGE = as.numeric(SAMPLE_COVERAGE),
    TMB_NONSYNONYMOUS = as.numeric(TMB_NONSYNONYMOUS),
    TUMOR_PURITY = as.numeric(TUMOR_PURITY)
  )

# Subset the dataset to include only numeric columns
numeric_data <- bladder_clin[, sapply(bladder_clin, is.numeric)]

# Create a pairplot with only numeric columns
pairplot <- GGally::ggpairs(numeric_data, cardinality_threshold = Inf)
pairplot

ggsave("pairplot.png", pairplot) # Guarda o pairplot como uma imagem .png no working directory

# Analisando o pairplot, podemos deduzir que as colunas que precisam de ser logaritmizadas s√£o: 
# MSI_SCORE
# MUTATION_COUNT
# SAMPLE_COVERAGE
# TMB_NONSYNONYMOUS

```

An√°lise Estat√≠stica de Dados de Cancro da Bexiga

Defini√ß√£o das Vari√°veis com as.factor
```{r}

# Idade em que a Sequencia√ß√£o foi Reportada (Anos)
age = as.factor(bladder_clin$AGE_AT_SEQ_REPORTED_YEARS)

# Tipo de Cancro
cancer_type = as.factor(bladder_clin$CANCER_TYPE_DETAILED)

# Estado da Doen√ßa
disease_state = as.factor(bladder_clin$DISEASE_STATE)

# Tratamento com Erdafitinib
erdafitinib_treatment = as.factor(bladder_clin$ERDAFITINIB_TREATED)

# Estado de Sobreviv√™ncia Global desde o Tx com Erdafitinib
overall_status = as.factor(bladder_clin$ERDAFITINIB_TX_OS_STATUS)

# Estado Sem Progress√£o desde o Tx com Erdafitinib
progression_status = as.factor(bladder_clin$ERDAFITINIB_TX_PFS_STATUS)

# Painel de Genes
gene_panel = as.factor(bladder_clin$GENE_PANEL)

# Tipo MSI
msi_type = as.factor(bladder_clin$MSI_TYPE)

# C√≥digo Oncotree
oncotree_code = as.factor(bladder_clin$ONCOTREE_CODE)

# Ra√ßa
race = as.factor(bladder_clin$RACE)

# Classe da Amostra
sample_class = as.factor(bladder_clin$SAMPLE_CLASS)

# Sexo
sexo = as.factor(bladder_clin$SEX)

# Estado de Fumador
smoking_status = as.factor(bladder_clin$SMOKIMG_STATUS)

# Estado Som√°tico
somatic_status = as.factor(bladder_clin$SOMATIC_STATUS)

```
## 1 Vari√°veis Num√©ricas

1.1. *Idade em que a Sequencia√ß√£o foi Reportada (Anos)*
1.2. *Sobreviv√™ncia Global (Meses desde o Tx com Erdafitinib)*
1.3. *Sobreviv√™ncia Sem Progress√£o (Meses desde o Tx com Erdafitinib)*
1.4. *Sobreviv√™ncia Global em Meses desde o Sequenciamento*

Na an√°lise dessas vari√°veis num√©ricas, come√ßamos por:

1. **Remover valores ausentes e calcular estat√≠sticas descritivas**:
    - Primeiro, os valores ausentes (NaNs) da coluna com vari√°veis num√©ricas s√£o removidos do conjunto de dados.
    - Em seguida, s√£o calculadas algumas estat√≠sticas descritivas:
        - **M√©dia dos valores da vari√°vel**: Calcula-se a m√©dia dos valores da vari√°vel presentes no conjunto de dados limpo.
        - **Mediana dos valores da vari√°vel**: Determina-se a mediana dos valores da vari√°vel.
        - **Desvio padr√£o dos valores da vari√°vel**: Calcula-se o desvio padr√£o dos valores da vari√°vel.
        - **Intervalo interquart√≠lico (IQR)**: O IQR √© a diferen√ßa entre o terceiro quartil (Q3) e o primeiro quartil (Q1) dos valores da vari√°vel.

2. **Barplot e boxplot**:
    - Um gr√°fico de barras (barplot) √© criado para visualizar a distribui√ß√£o dos valores da vari√°vel.
    - Um gr√°fico de caixa (boxplot) √© gerado para mostrar a varia√ß√£o e os poss√≠veis valores at√≠picos dos valores da vari√°vel.


1.1. Idade em que a Sequencia√ß√£o foi Reportada (Anos)
```{r}
# Remover valores ausentes e calcular estat√≠sticas descritivas
summary(na.omit(bladder_clin$AGE_AT_SEQ_REPORTED_YEARS))

# Desvio padr√£o
sd(na.omit(bladder_clin$AGE_AT_SEQ_REPORTED_YEARS))

# Intervalo Interquart√≠lico
IQR(na.omit(bladder_clin$AGE_AT_SEQ_REPORTED_YEARS))

# Barplot e boxplot
barplot(table(bladder_clin$AGE_AT_SEQ_REPORTED_YEARS))
boxplot(as.numeric(bladder_clin$AGE_AT_SEQ_REPORTED_YEARS),
        main = "Idade em que a Sequ√™ncia foi Reportada (Anos)",
        xlab = "Idade", horizontal = TRUE)

```
1.2. Sobreviv√™ncia Global (Meses desde o Tx com Erdafitinib)
```{r}
# Remover valores ausentes e calcular estat√≠sticas descritivas
summary(na.omit(bladder_clin$ERDAFITINIB_TX_OS_MONTHS))

# Desvio padr√£o
sd(na.omit(bladder_clin$ERDAFITINIB_TX_OS_MONTHS))

# Intervalo Interquart√≠lico
IQR(na.omit(bladder_clin$ERDAFITINIB_TX_OS_MONTHS))

# Barplot e boxplot
barplot(table(bladder_clin$ERDAFITINIB_TX_OS_MONTHS))
boxplot(as.numeric(bladder_clin$ERDAFITINIB_TX_OS_MONTHS),
        main = "Sobreviv√™ncia Global (Meses desde o Tx com Erdafitinib)",
        xlab = "Meses", horizontal = TRUE)


```
1.3. Sobreviv√™ncia Sem Progress√£o (Meses desde o Tx com Erdafitinib)
```{r}
# Remover valores ausentes e calcular estat√≠sticas descritivas
summary(na.omit(bladder_clin$ERDAFITINIB_TX_PFS_MONTHS))

# Desvio padr√£o
sd(na.omit(bladder_clin$ERDAFITINIB_TX_PFS_MONTHS))

# Intervalo Interquart√≠lico
IQR(na.omit(bladder_clin$ERDAFITINIB_TX_PFS_MONTHS))

# Barplot e boxplot
barplot(table(bladder_clin$ERDAFITINIB_TX_PFS_MONTHS))
boxplot(as.numeric(bladder_clin$ERDAFITINIB_TX_PFS_MONTHS), horizontal = T)

```
## 2. Vari√°veis Categ√≥ricas:

2.1. *Detalhes do Tipo de C√¢ncro*
2.2. *Estado da Doen√ßa*
2.3. *Tratamento com Erdafitinibe*
2.4. *Status de Sobreviv√™ncia Global desde o Tratamento com Erdafitinibe*
2.5. *Status de Progress√£o Livre desde o Tratamento com Erdafitinibe*
2.6. *Ra√ßa*
2.7. *Classe da Amostra*
2.8. *Sexo*
2.9. *Status de Fumador*
2.10. *Status Som√°tico*
2.11. *Tipo de MSI (Instabilidade de Microssat√©lites)*
2.12. *C√≥digo Oncotree*

Na an√°lise dessas vari√°veis num√©ricas, come√ßamos por:

1. **Gr√°fico de barras para visualizar as frequ√™ncias absolutas**:
    - Um gr√°fico de barras √© criado para representar a frequ√™ncia absoluta de cada categoria presente nos dados.
   
2. **C√°lculo das frequ√™ncias absolutas e relativas**:
    - Primeiro, as frequ√™ncias absolutas das diferentes categorias s√£o calculadas.
    - Em seguida, as frequ√™ncias relativas s√£o obtidas dividindo as frequ√™ncias absolutas pelo total de observa√ß√µes.

3. **Cria√ß√£o de um data frame com as frequ√™ncias absolutas e relativas**:
    - Um data frame chamado `freq_data` √© criado, contendo tr√™s colunas:
        - `Categoria`: Os nomes das diferentes categorias.
        - `Frequencia_Absoluta`: As frequ√™ncias absolutas correspondentes.
        - `Frequencia_Relativa`: As frequ√™ncias relativas correspondentes.

4. **Gr√°fico de barras para as frequ√™ncias absolutas**:
    - Um novo gr√°fico de barras √© gerado para representar as frequ√™ncias absolutas das categorias.

5. **Gr√°fico de barras para as frequ√™ncias relativas**:
    - Outro gr√°fico de barras √© criado para mostrar a distribui√ß√£o relativa das categorias.
    - O t√≠tulo do gr√°fico √© "Distribui√ß√£o Relativa por Categoria".
    - O eixo x √© rotulado como "Categoria" e o eixo y √© rotulado como "Frequ√™ncia Relativa".

6. **Gr√°fico de pizza**:
    - Por fim, um gr√°fico de pizza √© gerado para ilustrar a distribui√ß√£o relativa das categorias.
    - Os r√≥tulos das fatias da pizza incluem o nome da categoria e a porcentagem correspondente arredondada.

2.1. Detalhes do Tipo de C√¢ncro
```{r}
# Gr√°fico de barras para visualizar as frequ√™ncias absolutas
barplot(table(bladder_clin$CANCER_TYPE_DETAILED), 
        main = "Frequ√™ncia Absoluta por Tipo de Cancro",
        xlab = "Tipo de C√¢ncer", ylab = "Frequ√™ncia Absoluta")

# Calcular as frequ√™ncias absolutas e relativas
freq_abs <- table(bladder_clin$CANCER_TYPE_DETAILED)
freq_rel <- prop.table(freq_abs)

# Criar um data frame com as frequ√™ncias absolutas e relativas
freq_data <- data.frame(Categoria = names(freq_abs),
                        Frequencia_Absoluta = as.numeric(freq_abs),
                        Frequencia_Relativa = as.numeric(freq_rel))

# Gr√°fico de barras para as frequ√™ncias absolutas
barplot(freq_abs, main = "Frequ√™ncia Absoluta por Tipo de C√¢ncer",
        xlab = "Tipo de C√¢ncer", ylab = "Frequ√™ncia Absoluta")

# Gr√°fico de barras para as frequ√™ncias relativas
barplot(freq_rel, main = "Distribui√ß√£o Relativa por Tipo de C√¢ncer",
        xlab = "Tipo de C√¢ncer", ylab = "Frequ√™ncia Relativa")

# Criar o gr√°fico de pizza
pie(freq_rel, main = "Distribui√ß√£o Relativa por Tipo de Cancro",
    labels = paste(names(freq_rel), ": ", round(freq_rel * 100, 2), "%"), 
    col = rainbow(length(freq_rel)), cex = 0.8)
```
2.2. Estado da Doen√ßa
```{r}
# Gr√°fico de barras para visualizar as frequ√™ncias absolutas
barplot(table(bladder_clin$DISEASE_STATE), 
        main = "Frequ√™ncia Absoluta por Categoria",
        xlab = "Categoria", ylab = "Frequ√™ncia Absoluta")

# Calcular as frequ√™ncias absolutas e relativas
freq_abs <- table(bladder_clin$DISEASE_STATE)
freq_rel <- prop.table(freq_abs)

# Criar um data frame com as frequ√™ncias absolutas e relativas
freq_data <- data.frame(Categoria = names(freq_abs),
                        Frequencia_Absoluta = as.numeric(freq_abs),
                        Frequencia_Relativa = as.numeric(freq_rel))

# Gr√°fico de barras para as frequ√™ncias absolutas
barplot(freq_abs, main = "Frequ√™ncia Absoluta por Categoria",
        xlab = "Categoria", ylab = "Frequ√™ncia Absoluta")

# Gr√°fico de barras para as frequ√™ncias relativas
barplot(freq_rel, main = "Distribui√ß√£o Relativa por Categoria",
        xlab = "Categoria", ylab = "Frequ√™ncia Relativa")

# Criar o gr√°fico de pizza
pie(freq_rel, main = "Distribui√ß√£o Relativa por Categoria",
    labels = paste(names(freq_rel), ": ", round(freq_rel * 100, 2), "%"), 
    col = rainbow(length(freq_rel)),
    cex = 0.8)
```
2.3. Tratamento com Erdafitinibe
```{r}
# Gr√°fico de barras para visualizar as frequ√™ncias absolutas
barplot(table(bladder_clin$ERDAFITINIB_TREATED), 
        main = "Frequ√™ncia Absoluta por Categoria",
        xlab = "Categoria", ylab = "Frequ√™ncia Absoluta")

# Calcular as frequ√™ncias absolutas e relativas
freq_abs <- table(bladder_clin$ERDAFITINIB_TREATED)
freq_rel <- prop.table(freq_abs)

# Criar um data frame com as frequ√™ncias absolutas e relativas
freq_data <- data.frame(Categoria = names(freq_abs),
                        Frequencia_Absoluta = as.numeric(freq_abs),
                        Frequencia_Relativa = as.numeric(freq_rel))

# Gr√°fico de barras para as frequ√™ncias absolutas
barplot(freq_abs, main = "Frequ√™ncia Absoluta por Categoria",
        xlab = "Categoria", ylab = "Frequ√™ncia Absoluta")

# Gr√°fico de barras para as frequ√™ncias relativas
barplot(freq_rel, main = "Distribui√ß√£o Relativa por Categoria",
        xlab = "Categoria", ylab = "Frequ√™ncia Relativa")

# Criar o gr√°fico de pizza
pie(freq_rel, main = "Distribui√ß√£o Relativa por Categoria",
    labels = paste(names(freq_rel), ": ", round(freq_rel * 100, 2), "%"), 
    col = rainbow(length(freq_rel)),
    cex = 0.8)
```
2.4. Status de Sobreviv√™ncia Global desde o Tratamento com Erdafitinibe
```{r}
# Gr√°fico de barras para visualizar as frequ√™ncias absolutas
barplot(table(bladder_clin$ERDAFITINIB_TX_OS_STATUS), 
        main = "Frequ√™ncia Absoluta por Categoria",
        xlab = "Categoria", ylab = "Frequ√™ncia Absoluta")

# Calcular as frequ√™ncias absolutas e relativas
freq_abs <- table(bladder_clin$ERDAFITINIB_TX_OS_STATUS)
freq_rel <- prop.table(freq_abs)

# Criar um data frame com as frequ√™ncias absolutas e relativas
freq_data <- data.frame(Categoria = names(freq_abs),
                        Frequencia_Absoluta = as.numeric(freq_abs),
                        Frequencia_Relativa = as.numeric(freq_rel))

# Gr√°fico de barras para as frequ√™ncias absolutas
barplot(freq_abs, main = "Frequ√™ncia Absoluta por Categoria",
        xlab = "Categoria", ylab = "Frequ√™ncia Absoluta")

# Gr√°fico de barras para as frequ√™ncias relativas
barplot(freq_rel, main = "Distribui√ß√£o Relativa por Categoria",
        xlab = "Categoria", ylab = "Frequ√™ncia Relativa")

# Criar o gr√°fico de pizza
pie(freq_rel, main = "Distribui√ß√£o Relativa por Categoria",
    labels = paste(names(freq_rel), ": ", round(freq_rel * 100, 2), "%"), 
    col = rainbow(length(freq_rel)), cex = 0.8)
```
2.5. Status de Progress√£o Livre desde o Tratamento com Erdafitinibe
```{r}
# Gr√°fico de barras para visualizar as frequ√™ncias absolutas
barplot(table(bladder_clin$ERDAFITINIB_TX_PFS_STATUS), 
        main = "Frequ√™ncia Absoluta por Categoria",
        xlab = "Categoria", ylab = "Frequ√™ncia Absoluta")

# Calcular as frequ√™ncias absolutas e relativas
freq_abs <- table(bladder_clin$ERDAFITINIB_TX_PFS_STATUS)
freq_rel <- prop.table(freq_abs)

# Criar um data frame com as frequ√™ncias absolutas e relativas
freq_data <- data.frame(Categoria = names(freq_abs),
                        Frequencia_Absoluta = as.numeric(freq_abs),
                        Frequencia_Relativa = as.numeric(freq_rel))

# Gr√°fico de barras para as frequ√™ncias absolutas
barplot(freq_abs, main = "Frequ√™ncia Absoluta por Categoria",
        xlab = "Categoria", ylab = "Frequ√™ncia Absoluta")

# Gr√°fico de barras para as frequ√™ncias relativas
barplot(freq_rel, main = "Distribui√ß√£o Relativa por Categoria",
        xlab = "Categoria", ylab = "Frequ√™ncia Relativa")

# Criar o gr√°fico de pizza
pie(freq_rel, main = "Distribui√ß√£o Relativa por Categoria",
    labels = paste(names(freq_rel), ": ", round(freq_rel * 100, 2), "%"), 
    col = rainbow(length(freq_rel)), cex = 0.8)
```
2.6. Ra√ßa
```{r}
# Gr√°fico de barras para visualizar as frequ√™ncias absolutas
barplot(table(bladder_clin$RACE), 
        main = "Frequ√™ncia Absoluta por Categoria",
        xlab = "Categoria", ylab = "Frequ√™ncia Absoluta")

# Calcular as frequ√™ncias absolutas e relativas
freq_abs <- table(bladder_clin$RACE)
freq_rel <- prop.table(freq_abs)

# Criar um data frame com as frequ√™ncias absolutas e relativas
freq_data <- data.frame(Categoria = names(freq_abs),
                        Frequencia_Absoluta = as.numeric(freq_abs),
                        Frequencia_Relativa = as.numeric(freq_rel))

# Gr√°fico de barras para as frequ√™ncias absolutas
barplot(freq_abs, main = "Frequ√™ncia Absoluta por Categoria",
        xlab = "Categoria", ylab = "Frequ√™ncia Absoluta")

# Gr√°fico de barras para as frequ√™ncias relativas
barplot(freq_rel, main = "Distribui√ß√£o Relativa por Categoria",
        xlab = "Categoria", ylab = "Frequ√™ncia Relativa")

# Criar o gr√°fico de pizza
pie(freq_rel, main = "Distribui√ß√£o Relativa por Categoria",
    labels = paste(names(freq_rel), ": ", round(freq_rel * 100, 2), "%"), 
    col = rainbow(length(freq_rel)),
    cex = 0.8)
```
2.8. Sexo
```{r}
# Gr√°fico de barras para visualizar as frequ√™ncias absolutas
barplot(table(bladder_clin$SEX), 
        main = "Frequ√™ncia Absoluta por Categoria",
        xlab = "Categoria", ylab = "Frequ√™ncia Absoluta")

# Calcular as frequ√™ncias absolutas e relativas
freq_abs <- table(bladder_clin$SEX)
freq_rel <- prop.table(freq_abs)

# Criar um data frame com as frequ√™ncias absolutas e relativas
freq_data <- data.frame(Categoria = names(freq_abs),
                        Frequencia_Absoluta = as.numeric(freq_abs),
                        Frequencia_Relativa = as.numeric(freq_rel))

# Gr√°fico de barras para as frequ√™ncias absolutas
barplot(freq_abs, main = "Frequ√™ncia Absoluta por Categoria",
        xlab = "Categoria", ylab = "Frequ√™ncia Absoluta")

# Gr√°fico de barras para as frequ√™ncias relativas
barplot(freq_rel, main = "Distribui√ß√£o Relativa por Categoria",
        xlab = "Categoria", ylab = "Frequ√™ncia Relativa")

# Criar o gr√°fico de pizza
pie(freq_rel, main = "Distribui√ß√£o Relativa por Categoria",
    labels = paste(names(freq_rel), ": ", round(freq_rel * 100, 2), "%"), 
    col = rainbow(length(freq_rel)),
    cex = 0.8)
```
2.9. Status de Fumador
```{r}
# Gr√°fico de barras para visualizar as frequ√™ncias absolutas
barplot(table(bladder_clin$SMOKIMG_STATUS), 
        main = "Frequ√™ncia Absoluta por Categoria",
        xlab = "Categoria", ylab = "Frequ√™ncia Absoluta")

# Calcular as frequ√™ncias absolutas e relativas
freq_abs <- table(bladder_clin$SMOKIMG_STATUS)
freq_rel <- prop.table(freq_abs)

# Criar um data frame com as frequ√™ncias absolutas e relativas
freq_data <- data.frame(Categoria = names(freq_abs),
                        Frequencia_Absoluta = as.numeric(freq_abs),
                        Frequencia_Relativa = as.numeric(freq_rel))

# Gr√°fico de barras para as frequ√™ncias absolutas
barplot(freq_abs, main = "Frequ√™ncia Absoluta por Categoria",
        xlab = "Categoria", ylab = "Frequ√™ncia Absoluta")

# Gr√°fico de barras para as frequ√™ncias relativas
barplot(freq_rel, main = "Distribui√ß√£o Relativa por Categoria",
        xlab = "Categoria", ylab = "Frequ√™ncia Relativa")

# Criar o gr√°fico de pizza
pie(freq_rel, main = "Distribui√ß√£o Relativa por Categoria",
    labels = paste(names(freq_rel), ": ", round(freq_rel * 100, 2), "%"), 
    col = rainbow(length(freq_rel)),
    cex = 0.8)
```
2.10. Status Som√°tico
```{r}
# Gr√°fico de barras para visualizar as frequ√™ncias absolutas
barplot(table(bladder_clin$SOMATIC_STATUS), 
        main = "Frequ√™ncia Absoluta por Categoria",
        xlab = "Categoria", ylab = "Frequ√™ncia Absoluta")

# Calcular as frequ√™ncias absolutas e relativas
freq_abs <- table(bladder_clin$SOMATIC_STATUS)
freq_rel <- prop.table(freq_abs)

# Criar um data frame com as frequ√™ncias absolutas e relativas
freq_data <- data.frame(Categoria = names(freq_abs),
                        Frequencia_Absoluta = as.numeric(freq_abs),
                        Frequencia_Relativa = as.numeric(freq_rel))

# Gr√°fico de barras para as frequ√™ncias absolutas
barplot(freq_abs, main = "Frequ√™ncia Absoluta por Categoria",
        xlab = "Categoria", ylab = "Frequ√™ncia Absoluta")

# Gr√°fico de barras para as frequ√™ncias relativas
barplot(freq_rel, main = "Distribui√ß√£o Relativa por Categoria",
        xlab = "Categoria", ylab = "Frequ√™ncia Relativa")

# Criar o gr√°fico de pizza
pie(freq_rel, main = "Distribui√ß√£o Relativa por Categoria",
    labels = paste(names(freq_rel), ": ", round(freq_rel * 100, 2), "%"), 
    col = rainbow(length(freq_rel)),
    cex = 0.8)
```
## 3. Vari√°veis Cont√≠nuas:

3.1. *Melhor Resposta ao Erdafitinib*
3.2. *Fra√ß√£o do Genoma Alterado*
3.3. *Contagem de Muta√ß√µes*
3.4. *TMB*
3.5. *Pureza do Tumor*


Na an√°lise dessas vari√°veis num√©ricas, come√ßamos por:

1. **Resumo estat√≠stico**: Utiliza a fun√ß√£o `summary()` para calcular estat√≠sticas descritivas, como m√≠nimo, 1¬∫ quartil, mediana, m√©dia, 3¬∫ quartil e m√°ximo da vari√°vel dependente. Os valores ausentes s√£o removidos antes do c√°lculo (`na.omit()`).

2. **Desvio padr√£o**: Calcula o desvio padr√£o da vari√°vel dependente usando a fun√ß√£o `sd()`. Novamente, os valores ausentes s√£o removidos antes do c√°lculo.

3. **Intervalo interquart√≠lico (IQR)**: Calcula o intervalo interquart√≠lico da vari√°vel dependente usando a fun√ß√£o `IQR()`. Os valores ausentes s√£o removidos antes do c√°lculo.

4. **Visualiza√ß√£o de frequ√™ncia**: Plota um histograma de frequ√™ncia dos valores da vari√°vel dependente usando a fun√ß√£o `plot(table(...))`.

5. **Gr√°fico de caixa (boxplot)**: Cria um gr√°fico de caixa para visualizar a distribui√ß√£o dos valores da vari√°vel dependente. Os valores ausentes s√£o removidos antes de criar o gr√°fico.


3.1. Melhor Resposta ao Erdafitinib
```{r}
# Remover valores ausentes e calcular o valor minimo, 1¬∫ quartil, mediana, m√©dia, 3¬∫ quartil e valor m√°ximo da variavel.
summary_best_response <- summary(na.omit(bladder_clin$BEST_RESPONSE))
# Visualizar os valores
summary_best_response

# Remover valores ausentes e calcular o desvio padr√£o da variavel.
sd_best_response <- sd(na.omit(bladder_clin$BEST_RESPONSE))
# Visualizar o valor
sd_best_response

# Remover valores ausentes e calcular o Intervalo interquartilico.
IQR_best_response <- IQR(na.omit(bladder_clin$BEST_RESPONSEb))
# Visualizar o valor
IQR_best_response

plot(table(bladder_clin$BEST_RESPONSE))

# Criar o gr√°fico de caixa
boxplot(na.omit(bladder_clin$BEST_RESPONSE),  
        main = "Melhor resposta ao Erdafitinib",   
        xlab = "Melhor Resposta",                 
        horizontal = TRUE)                       
```
3.2. Fra√ß√£o do Genoma Alterado
```{r}
# Remover valores ausentes e calcular o valor minimo, 1¬∫ quartil, mediana, m√©dia, 3¬∫ quartil e valor m√°ximo da variavel.
summary_ <- summary(na.omit(bladder_clin$FRACTION_GENOME_ALTERED))
# Visualizar os valores
summary_

# Remover valores ausentes e calcular o desvio padr√£o da variavel.
sd_ <- sd(na.omit(bladder_clin$FRACTION_GENOME_ALTERED))
# Visualizar o valor
sd_

# Remover valores ausentes e calcular o Intervalo interquartilico.
IQR_ <- IQR(na.omit(bladder_clin$FRACTION_GENOME_ALTERED))
# Visualizar o valor
IQR_

# Calcular a vari√¢ncia
var_ <- var(na.omit(bladder_clin$FRACTION_GENOME_ALTERED))

# Visualizar o valor da vari√¢ncia
var_

# Criar o gr√°fico de caixa
# Filtrar os dados nao numericos
filtered_data <- bladder_clin[complete.cases(bladder_clin$FRACTION_GENOME_ALTERED), ]
boxplot(filtered_data$FRACTION_GENOME_ALTERED, horizontal=T)
```
3.3. Contagem de Muta√ß√µes
```{r}
# Remover valores ausentes e calcular o valor minimo, 1¬∫ quartil, mediana, m√©dia, 3¬∫ quartil e valor m√°ximo da variavel.
summary_ <- summary(na.omit(bladder_clin$MUTATION_COUNT))
# Visualizar os valores
summary_

# Remover valores ausentes e calcular o desvio padr√£o da variavel.
sd_ <- sd(na.omit(bladder_clin$MUTATION_COUNT))
# Visualizar o valor
sd_

# Remover valores ausentes e calcular o Intervalo interquartilico.
IQR_ <- IQR(na.omit(bladder_clin$MUTATION_COUNT))
# Visualizar o valor
IQR_

# Calcular a vari√¢ncia
var_ <- var(na.omit(bladder_clin$MUTATION_COUNT))

# Visualizar o valor da vari√¢ncia
var_

barplot(table(bladder_clin$MUTATION_COUNT))

# Criar o gr√°fico de caixa
boxplot(bladder_msk_2023_clinical_data$"Mutation.Count", horizontal=T)
```
## 4.
MUTATION_COUNT  FRACTION_GENOME_ALTERED 
MUTATION_COUNT  TMB_NONSYNONYMOUS


Considerando as vari√°veis x e y:
Realizamos as estat√≠sticas sum√°rias de x para cada y.
```{r}
# Estat√≠sticas sum√°rias de x para cada n√≠vel de y
est_sum√°rias <- tapply(x, y, summary, na.rm = TRUE)
# ou
by(x, y, summary)

# b) Represente a boxplot de x para cada n√≠vel de y)
boxplot(x ~ y, col = 0)

# c) Ser√° que os dois grupos apresentam a mesma vari√¢ncia?
# Hip√≥teses:
# H0: A vari√¢ncia √© a mesma nos grupos standard e de teste
# H1: A vari√¢ncia n√£o √© a mesma
teste_var <- var.test(x ~ y)
teste_var
if (teste_var$p.value > 0.05)
  cat("N√£o Rejeitar H0") 
else 
  cat("Rejeitar H0")

Efetuamos o teste estat√≠stico mais apropriado, neste caso o t-test os valores m√©dios de x face a y.
# Hip√≥teses:
# H0: N√£o existem diferen√ßas
# H1: Existem diferen√ßas no x dependendo do y

teste_t <- t.test(x ~ y, var.equal = TRUE)
teste_t
# Decis√£o de acordo com o valor-p
#RESPOSTA: VALOR DA ESTATISTICA DE TESTE: F(...)=... ; decis√£o de acordo com valor de p

Efectuamos  o teste estat√≠stico mais apropriado para os valores m√©dios de 
    x face a y (Escrever as hip√≥teses, temos de indicar o valor da estat√≠stica de teste e )
      #apresente a decis√£o para um Œ±=5%).
    
    #H0: n√£o existem diferen√ßas
    #H1: existem diferen√ßas no x dependendo do y
    teste_t=t.test(x~y, var.equal=T)
    teste_t
    #RESPOSTA; ET-> t(...)=...; decis√£o segundo p.value
    

Considerando agora a distribui√ß√£o de x/y (execute o comando table()). --> aten√ß√£o que se a variavel estiver em texto, se tiver codificado temos de declarar as a factor tal como j√° foi feito
    #Pensa-se que a distribui√ß√£o de x √© a mesma em cada categoria(y).  ---> ou seja, distribui√ßao uniforme (p=/)
    
    #Determine as frequ√™ncias esperadas para o x de acordo com as probabilidades te√≥ricas.
    
    tabela=table(x)
    tabela
    
    pi=c(1/4,1/4,1/4,1/4)
    ei=pi*sum(tabela)
    ei
    
    #bConstruimos o gr√°fico de barras que compare as frequ√™ncias observadas com as esperadas.
    barplot(rbind (tabela,ei), beside = T, col=c(2,3))
    
    #Confirmar se x segue uma distribui√ß√£o uniforme? (Escrever as hip√≥teses,
    #indicar o valor da estat√≠stica de teste e o valor prova e decisao considerando Œ±=5%).
    
    #H0: a distribui√ßao de x √© uniforme
    #H1: a distribui√ßao de x n√£o √© uniforme
    
    teste_qui= chisq.test(tabela, p=pi)
    
#Verificamos se existe associa√ß√£o entre o x e y.
    #Escrevemos as hip√≥teses, indicamos o valor da estat√≠stica de teste e apresente a decis√£o para um  Œ±=5%)
    #H0: o x e o y sao independentes 
    #H1: o x e o y n√£o sao independentes
    
    m=table(x,y)   ##-->para tratar os dados e coloc√°-los em tabela    -->vemos se est√° certo pelos graus de liberdade que depois nos d√° no resultado do teste
    teste_ind=chisq.test(m)
    teste_ind
    
#Para avaliar se o tempo de x m√©dio √© o mesmo para cada grupo y, foi considerada a avalia√ß√£o da vari√°vel transformada, logaritmo de x
    #(log(time)), segundo cada grupo de c√©lulas. 
    # Desenhamos o gr√°fico boxplot que permita efetuar a compara√ß√£o da distribui√ß√£o do logaritmo do tempo de sobrevida segundo o tipo de c√©lulas
    
    boxplot(log(x)~y, col=6)
    
    
  #Testamos a hip√≥tese nula ùêª0: ùúá1 = ùúá2 = ùúá3 = ùúá4, onde ÔÅ≠i indica o x m√©dio para cada grupo de y. √â sugerida a utiliza√ß√£o de uma ANOVA para a vari√°vel transformada (log(x)). Verifique os pressupostos para poder efetuar a dita an√°lise. Consideramos Œ±=1%. (Utilizamos tambem o teste de shapiro e o teste de fligner)
    
    
    #normalidade
    shapiro.test(log(x))
    
    #homogeneidade      --------> se rejeitasse colocavamos var.equal=T
    fligner.test()
    
  # depois de confirmar os pressupostos de normalidade e homogeneidade realizamos a anova
    modelo=aov(log(x)~y)
    summary(modelo)
    TukeyHSD(modelo, conf.level=0.99)      #compara√ß√µes m√∫ltiplas
    plot(TukeyHSD(modelo, conf.level = 0.99))
    
# Pretendemos avaliar se x m√©dio varia de acordo com o grupo de y e o z. Para tal sugere-se a realiza√ß√£o de uma ANOVA que permita avaliar os efeitos principais e a poss√≠vel intera√ß√£o entre o tipo de x e y utilizada. Que pode concluir (use Œ±=5%)
    
    modelo=aov(x~y)     #ANOVA TWO WAY
    summary(model)
    plot(model)
    
    attach(modelo em questao)
    
    #gr√°ficos de intera√ßao
    interaction.plot(x,y,z)
    interaction.plot(x,y,z)
    
    TukeyHSD(model)
    
    plot(TukeyHSD(model))
    
    shapiro.test(model$residuals)  
    #vamos ver que rejeita H0 mas amostra grande (teorema do limite central)
    
    #RESPOSTA: os resultados dos modelos anova rwoway permitem nos concluir que existem ou n√£o efeitos significativos no x medio nos grupos y e tambem no z como podemos ver pelo interaction plot)
    
    
